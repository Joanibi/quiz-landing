<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Quiz Fitness</title>
  <style>
    /* Fundo degrad√™ */
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #4a00e0, #8e2de2);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .quiz-container {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px 40px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 20px;
      color: #fff;
    }

    .progress {
      height: 6px;
      width: 100%;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      margin-bottom: 30px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: #6c63ff;
      border-radius: 3px;
      transition: width 0.3s ease-in-out;
    }

    .pergunta {
      margin-bottom: 25px;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }

    .pergunta p {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #fff;
      font-weight: 500;
    }

    .pergunta button {
      display: block;
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      padding: 14px;
      margin-bottom: 15px;
      border-radius: 12px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      text-align: left;
    }

    .pergunta button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-4px);
    }

    .pergunta button:active {
      transform: translateY(0);
      background: rgba(255, 255, 255, 0.3);
    }

    .oculta {
      display: none !important;
    }

    .footer-text {
      text-align: center;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 20px;
    }

    /* Loading message */
    #loading p {
      font-size: 1.2rem;
      color: #fff;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1>Descubra seu estilo fitness!</h1>

    <div class="progress">
      <div id="progress-bar" class="progress-bar"></div>
    </div>

    <div id="p1" class="pergunta" data-pergunta="Qual seu objetivo principal?">
      <p>Qual seu objetivo principal?</p>
      <button onclick="responder(this)" data-resposta="Ganhar massa" data-next="p2">üí™ Ganhar massa</button>
      <button onclick="responder(this)" data-resposta="Perder peso" data-next="p2">‚ö° Perder peso</button>
      <button onclick="responder(this)" data-resposta="Defini√ß√£o" data-next="p2">üèãÔ∏è Defini√ß√£o</button>
    </div>

    <div id="p2" class="pergunta oculta" data-pergunta="Com que frequ√™ncia treina?">
      <p>Com que frequ√™ncia treina?</p>
      <button onclick="responder(this)" data-resposta="1-2x por semana" data-next="p3">1-2x por semana</button>
      <button onclick="responder(this)" data-resposta="3-4x por semana" data-next="p3">3-4x por semana</button>
      <button onclick="responder(this)" data-resposta="5x ou mais" data-next="p3">5x ou mais</button>
    </div>

    <div id="p3" class="pergunta oculta" data-pergunta="Qual seu tipo de treino preferido?">
      <p>Qual seu tipo de treino preferido?</p>
      <button onclick="responder(this)" data-resposta="Muscula√ß√£o" data-next="finalizar">Muscula√ß√£o</button>
      <button onclick="responder(this)" data-resposta="Cardio/Corrida" data-next="finalizar">Cardio/Corrida</button>
      <button onclick="responder(this)" data-resposta="Funcional/Cross" data-next="finalizar">Funcional/Cross</button>
    </div>

    <div id="loading" class="pergunta oculta">
      <p>üéâ Finalizando seu quiz e preparando seu resultado...</p>
    </div>

    <div class="footer-text">
      Responda com honestidade para obter o melhor resultado
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzL56xXNuf1S-9GeV1Dn_7WPMTC1HYaIQKhbrisNToSc8N7X5xmpbeknmCUxHhEG05uvw/exec";
    const perguntasDivs = document.querySelectorAll('.pergunta:not(#loading)');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.querySelector('.progress');
    const loadingDiv = document.getElementById('loading');
    const totalPerguntas = perguntasDivs.length;
    let perguntasRespondidas = 0;
    progressBar.style.width = '0%';

    function enviarDadosEmSegundoPlano(pergunta, resposta) {
      const formData = new FormData();
      formData.append("pergunta", pergunta);
      formData.append("resposta", resposta.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]|\s/g, '').trim());
      formData.append("origem", window.location.href);

      fetch(SCRIPT_URL, {
        method: "POST",
        body: formData 
      })
      .then(response => response.json())
      .then(data => {
        if (data.status !== 'sucesso') {
          console.warn(`[Apps Script Erro] Resposta falhou ao salvar: ${pergunta} -> ${data.mensagem}`);
        } else {
          console.log(`[Apps Script Sucesso] Resposta salva: ${pergunta}`);
        }
      })
      .catch(err => {
        console.error(`[ERRO GRAVE] Falha no envio para a planilha: ${pergunta}`, err);
      });
    }

    function responder(botao) {
      const perguntaDiv = botao.closest('.pergunta');
      const perguntaTexto = perguntaDiv.getAttribute("data-pergunta");
      const respostaTexto = botao.innerText;
      const proximaId = botao.getAttribute("data-next");

      enviarDadosEmSegundoPlano(perguntaTexto, respostaTexto);

      perguntasRespondidas++;
      const progressoPercentual = (perguntasRespondidas / totalPerguntas) * 100;
      progressBar.style.width = progressoPercentual + '%';

      perguntaDiv.classList.add('oculta');
      if (proximaId === 'finalizar') {
        progressContainer.classList.add('oculta');
        document.querySelector('.footer-text').classList.add('oculta');
        loadingDiv.classList.remove('oculta');
      } else {
        const proximaDiv = document.getElementById(proximaId);
        if (proximaDiv) {
          proximaDiv.classList.remove('oculta');
        } else {
          loadingDiv.innerText = "Erro ao carregar a pr√≥xima pergunta. O quiz foi finalizado.";
          loadingDiv.classList.remove('oculta');
        }
      }
    }
  </script>
</body>
</html>
